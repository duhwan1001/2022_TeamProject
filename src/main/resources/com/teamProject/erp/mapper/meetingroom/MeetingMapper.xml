<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.teamProject.erp.mapper.mroom.MeetingMapper">

    <resultMap id="mrMap" type="com.teamProject.erp.dto.MeetingDTO">
        <result property="mrNo" column="mr_no"/>
        <result property="mrUsers" column="mr_users"/>
        <result property="mrTime" column="mr_time"/>
        <result property="mrTitle" column="mr_title"/>
        <result property="mrContent" column="mr_content"/>

        <result property="userId" column="user_id"/>
        <result property="fileNo" column="file_no"/>
    </resultMap>

    <insert id="save">
        INSERT INTO meetingroom
        (mr_no, mr_users, mr_time, mr_title, mr_content)
        VALUES (#{mr_no}, #{mr_users}, #{mr_time}, #{mr_title}, #{mr_content})
    </insert>

    <select id="findAll" resultMap="mrMap">
        SELECT *
        FROM meetingroom
        ORDER BY mr_no DESC
        LIMIT #{start}, #{amount}
    </select>

    <select id="findAll2" resultMap="mrMap">
        SELECT *
        FROM meetingroom
        <if test="type == 'title'">
            WHERE title LIKE CONCAT('%', #{keyword}, '%')
        </if>
        <if test="type == 'content'">
            WHERE content LIKE CONCAT('%', #{keyword}, '%')
        </if>
        <if test="type == 'writer'">
            WHERE writer LIKE CONCAT('%', #{keyword}, '%')
        </if>
        <if test="type == 'tc'">
            WHERE title LIKE CONCAT('%', #{keyword}, '%')
            OR content LIKE CONCAT('%', #{keyword}, '%')
        </if>
        ORDER BY mr_no DESC
        LIMIT #{start}, #{amount}
    </select>

    <select id="findOne" resultMap="mrMap">
        SELECT * FROM meetingroom
        WHERE mr_no=#{mrNo}
    </select>

    <delete id="remove">
        DELETE FROM meetingroom
        WHERE mr_no=#{mrNo}
    </delete>

    <update id="modify">
        UPDATE meetingroom
        SET writer = #{writer}, title=#{title}, content=#{content}
        WHERE mr_no=#{mrNo}
    </update>

    <select id="getTotalCount" resultType="int">
        SELECT COUNT(*)
        FROM meetingroom
    </select>

    <select id="getTotalCount2" resultType="int">
        SELECT COUNT(*)
        FROM meetingroom
        <if test="type == 'title'">
            WHERE title LIKE CONCAT('%', #{keyword}, '%')
        </if>
        <if test="type == 'content'">
            WHERE content LIKE CONCAT('%', #{keyword}, '%')
        </if>
        <if test="type == 'writer'">
            WHERE writer LIKE CONCAT('%', #{keyword}, '%')
        </if>
        <if test="type == 'tc'">
            WHERE title LIKE CONCAT('%', #{keyword}, '%')
            OR content LIKE CONCAT('%', #{keyword}, '%')
        </if>
    </select>

    <!-- 첨부파일 추가  -->
    <insert id="addFile">
        INSERT INTO file_upload
            (file_name, mno)
        VALUES
            (#{fileName}, LAST_INSERT_ID())
    </insert>

    <select id="findFileNames" resultType="string">
        SELECT file_name
        FROM file_upload
        WHERE mno = #{mno}
    </select>

    <select id="findMemberByMrNo" resultType="com.teamProject.erp.dto.ValidateMemberDTO">
        SELECT account, auth
        FORM meetingroom
        WHERE account = (
            SELECT account
            FROM meetingroom
            WHERE mr_no = #{mrNo}
        )
    </select>
</mapper>

<!--        private int mrNo;-->
<!--        private String mrUsers;-->
<!--        private Date mrTime;-->
<!--        private String mrTitle;-->
<!--        private String mrContent;-->

<!--        private int fileNo;-->
<!--        private String userId;-->
